
<%= render 'title', :locals => { :title => @title }%>

<!-- FILTER -->
  <div class="container-fluid">
    <div class="field">
      <label class="checkbox">
        <%= check_box_tag :generate, "yes" %>
        Filtrer les Opportunités
      </label>
    </div>
  </div>
  
  
<div id="task_value" class="container-fluid" style= "display: none;">  
  
  <%= form_for(:filter, :url => { :action => 'filter' } , :html => {:method => :get} ) do |f| %>
      
      <div class="span2">
        Statut : <%= f.select :statut, Opportunity::STATUTS,{:include_blank => "Tous"} , :class =>"filter_statut"%>
      </div>
      
      <div class="span3">
        Compte : <%= f.text_field :account , :class =>"filter_tfield", :data => { :provide => 'typeahead', :source => @autocomplete_accounts}, :autocomplete=>"off"%>
      </div>
      
      <div class="span3">
        Contact : <%= f.text_field :contact , :class =>"filter_tfield", :data => { :provide => 'typeahead', :source => @autocomplete_contacts}, :autocomplete=>"off"%>
      </div>
    
      <div class="span3">
        Date Début : <%= f.text_field :date_begin, :class =>"filter_date"%>
      </div>
      
      <div class="span3">
        Date Fin : <%= f.text_field :date_end, :class =>"filter_date"%>
      </div>
      
      <div class="span3">
        Collaborateur : <%= f.collection_select :user, User.all_reals, :id, :full_name, {:include_blank => "Tous"} , :class =>"filter_coll"%>
      </div>
      
      <div class="span1" style="margin-top: 18px;">
        <%= f.submit "Filtrer", :class =>"btn "%>
      </div>
    
  <% end %>
  
</div>


<!-- END FILTER -->

<div class="container-fluid">
  <table class="table table-bordered table-striped table-hover">
    <thead>
      <tr>
        <th class="text-center">#</th>
        <th class="text-center">Statut</th>
        <th class="text-center">Compte</th>
        <th class="text-center">Libellé</th>
        <th class="text-center">Contact</th>
        <th class="text-center">Estimation</th>
        <th class="text-center">Marge</th>
        <th class="text-center">Échéance</th>
        <th class="text-center">Collaborateur</th>
        <th class="text-center">Éditer</th>   
      </tr>
    </thead>
    <tbody>
      <% @opportunities.each do |opportunity| %>
      <tr>
		<% if !opportunity.id.nil? %>
		<td class="text-center"><%= opportunity.id %></td>
		<% else %>
		<td class="text-center">-</td>
		<% end %>       
		<td class="text-center">
          <% if opportunity.statut == "Détectée"%>
          <span class="badge badge-important">
          <% elsif opportunity.statut == "En cours"%>
          <span class="badge badge-warning">
          <% elsif opportunity.statut == "Gagnée"%>
          <span class="badge badge-success">
          <% elsif opportunity.statut == "Perdue"%>
          <span class="badge badge-inverse">
          <% else %>
          -
          <% end %>
		  <%= opportunity.statut %>
		  </span>
        </td>
		<% if !opportunity.account.nil? %>
		<td class="text-center"><%= link_to opportunity.account.company , account_events_url(opportunity.account),{:title => "Afficher les évènements"} %></td>
		<% else %>
		<td class="text-center">-</td>
		<% end %>         
		<% if !opportunity.name.blank? %>
		<td class="text-center"><%= link_to opportunity.name,  edit_opportunity_path(opportunity),{:title => "Éditer l'opportunité"} %></td>
		<% else %>
		<td class="text-center">-</td>
		<% end %>         
		<% if !opportunity.contact.nil? %>
		<td class="text-center"><%= link_to opportunity.contact.full_name, edit_contact_path(opportunity.contact) ,{:title => "Éditer le contact"} %></td>
		<% else %>
		<td class="text-center">-</td>
		<% end %>       
		<% if !opportunity.amount.nil? %>
		<td style="text-align :right;"><%= number_to_currency(opportunity.amount, :locale => :fr)  %> <strong> HT </strong></td>
		<% else %>
		<td class="text-center">-</td>
		<% end %>
		<% if !opportunity.profit.nil? %>
		<td style="text-align :right;"><%= number_to_currency(opportunity.profit, :locale => :fr)  %> <strong> HT </strong></td>
		<% else %>
		<td class="text-center">-</td>
		<% end %>
		<% if !opportunity.term.nil? %>
		<td class="text-center"><%=  opportunity.term.strftime("%d/%m/%y") %></td>
		<% else %>
		<td class="text-center">-</td>
		<% end %>
		<% if !opportunity.user.nil? %>
		<td class="text-center"><%= opportunity.user.full_name %></td>
		<% else %>
		<td class="text-center">-</td>
		<% end %>
		<td class="text-center"><%= link_to image_tag("glyphicons/glyphicons_151_edit.png"), edit_opportunity_path(opportunity),{:title => "Éditer l'opportunité", :class =>"btn"}  %></td>
      </tr>
      <% end %>
    </tbody>
  </table>
  <%= paginate @opportunities %>
  <div class="page-header pull-right text-right">
    <h4> Montant total estimé : <%= number_to_currency(@total_amount, :locale => :fr) %>  HT</h4><br />
    <h4> Marge totale estimée : <%= number_to_currency(@total_profit, :locale => :fr) %>  HT</h4> 
  </div>
</div>
