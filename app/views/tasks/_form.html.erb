<%= form_for(@task, :html => { :class => "well "}) do |f| %>
  <% if @task.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@task.errors.count, "error") %> prohibited this task from being saved:</h2>
      <ul>
      <% @task.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  <div class="field">
    <div class="span2"> Compte : </div>
      <% company = ""
	   if !@task.account.nil?
	     company = @task.account.company.html_safe
	   end %>
      <p>
        <input value="<%= company %>" id="account-search" type="search" autocomplete="off" />
        <img src="/assets/icons/loading.gif" class="loading hidden" />
        <span class="label label-info" id="task_notice"  style="display: none; margin-left: 2em;">
            <i class="icon-warning-sign icon-white"></i> Un événement sera créé sur le compte correspondant
        </span>
      </p>
      <%= f.text_field :account_id, { :style => 'display: none; visible: none;', :id => 'account_id' } %>
  </div> 
  <div class="field" id="nameContacts">
    <%= render :partial => 'contacts' %>
  </div>
  <div class="field">
    <div class="span2"> Affectée à : </div> 
      <p><%= f.collection_select :user_id, @users, :id, :full_name %>
		<label for="task[mail]" class="checkbox right-field">
          <input type="checkbox" name="task[mail]" id="task_mail" value="yes" />
		  Envoyer un Mail à ce collaborateur
        </label>
	  </p>
  </div>
  <div class="field">
    <div class="span2"> Sujet : </div> 
    <p><%= f.text_field :title , { :required => 'required', :style=>'width: 30em;'} %></p>
  </div>
  
  <div class="field">
	  <div class="span2">Description : </div>
	  <%= f.text_area :notes, :display_with => :simple_format, :rows => "5", :style=>'width: 30em;'%>
  </div>
 <div class="field">
    <div class="span2"><p> Statut : </p></div><p> <%= f.select :statut, Task::STATUTS %></p>
  </div>
  
   <div class="field">
    <div class="span2"> Priorité : </div>
    <p>
      <%
        if @task.priority.nil?
          @task.priority = 1
        end
      %>
      <select name="task[priority]" id="task_priority">
        <% Task::PRIORITIES.each_with_index do |value, index| %>
          <option value="<%= index %>"<%= if @task.priority == index then ' selected=selected' end %>><%= value %></option>
        <% end %>
      </select>

    </p>
  </div>
  <div class="field">
    <div class="span2"> Echéance :  </div> <%= f.text_field :term %>
  </div>  
  

	<% if @task.attach.exists? %> 
		<div class="field"><div class="span2">Pièce jointe actuelle : </div><%= link_to image_tag('glyphicons/glyphicons_062_attach.png') + ' ' + @task.attach_file_name, @task.attach.url, :target => '_blank' %></div>
		<div class="field"><div class="span2">Modifier pièce jointe : </div><%= f.file_field :attach, :style=>'width: 20em;' %></div>
		<% else %>
		<div class="field"><div class="span2">Pièce jointe : </div><%= f.file_field :attach, :style=>'width: 20em;' %></div>
	<% end %>
 

  <br />

  <div class="field">
    <div class="span9"><%= check_box_tag :generate, "yes" %> Infos de l'événement</div>
  </div>
  <br />
  <br />
  
  <div id="task_values" style="display: none;">
  <div class="field">
    <div class="span2">Type de l'évènement : </div> 
		<%= collection_select :event_type, :id ,EventType.order('label'),:id, :full_type, {:style =>"width: 100%", :include_blank => true }%>
    </div>
 
  
  <div class="field">
    <div class="span2">Notes de l'évènement : </div>
		<%= text_area_tag :notes , nil,:display_with => :simple_format, :rows => "5", :style=>'width: 30em;' %>
    </div>
  </div>

  <br />
  	
	<div class="field">
    <% if !@task.id.nil? %>
		<div class="span9"> Créée par : <%= @task.author.full_name %>, le </strong><%= @task.created_at.strftime("%d/%m/%y à %H:%M") %>. </div> <br />
		
		<% if !@task.modified_by.nil? %>
			<div class="span9"> Dernièrement modifiée par : <%= @task.editor.full_name %>, le <%= @task.updated_at.strftime("%d/%m/%y à %H:%M") %>. </div> <br />
		
		<% else %>
		<% end %>
	
	<% end %>
	</div>
	  
	<hr />
    
  <div class="row">
	  <%= if !@task.id.nil? then f.submit 'Modifier cette Tâche', :class =>"btn btn-primary" else f.submit 'Créer une Tâche', :class =>"btn btn-primary" end %>

      <%= if !@task.id.nil? then link_to image_tag("glyphicons/glyphicons_016_bin.png"), @task, :title => "Supprimer la tâche" , :confirm => 'Confirmer la suppression ?', :class =>"pull-right btn", :method => :delete end %>    
  </div>

<% end %>
