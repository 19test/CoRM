<div class="well">
  <%= nested_form_for @quotation do |f| %>
    <% if @quotation.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@quotation.errors.count, "error") %> prohibited this Quotation from being saved:</h2>
  
        <ul>
        <% @quotation.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
        </ul>
      </div>
    <% end %>
  
    <div class="page-header">
      <h3> En-tête </h3>
    </div>
	  <div class="field"> 
        <div class="span2">Libellé : </div><%= f.text_field :label, { :class => 'required'} %>
      </div>
	
      <div class="field"> 
        <div class="span2">Référence : </div><%= f.text_field :ref %>
      </div>
      <div class="field">
        <div class="span2"> Date : </div> <%= f.text_field :date, { :class => 'required', :value => (f.object.date.strftime("%d/%m/%Y") unless f.object.date.nil?) } %>
      </div>
      <div class="field">
        <div class="span2"> Compte : </div> <%= f.collection_select :account_id, Account.order('company ASC').all, :id, :company, { :class => 'required' } %>
      </div>
      <div class="field">
        <div class="span2"> Référence client : </div> <%= f.text_field :ref_account %>
      </div>
      
      <div class="field" id="nameContacts">
        <%= render :partial => 'contacts' %>
      </div>
      <div class="field">
        <div class="span2"> Collaborateur : </div> <%= f.collection_select :user_id, User.all, :id, :full_name %>
      </div>
    <hr />
    
    
    <div class="page-header">
      <h3> Lignes du devis </h3>
    </div>
    
    <div class="field" style="margin-left: 2em;">
      <%= f.fields_for :quotation_lines %>
      <%= f.link_to_add "Ajouter une ligne", :quotation_lines ,{:class => "btn btn-success"} %>
      <br /><br />
      <!-- <h4>Total HT = <%#= f.text_field :total_excl_tax , :style =>"width: 80px; text-align: right;", :disabled => true %> €</h4> -->
    </div>
    <br />
    
    <div class="field">

    </div>
    <hr />
    
    <div class="page-header">
      <h3> Modalités </h3>
    </div>
      <div class="field"> 
        <div class="span2">Validité du devis : </div><%= f.text_field :validity, { :class => 'required' } %> jours
      </div>
      <div class="field"> 
        <div class="span2">Mode de règlement : </div><%= f.text_field :mode_reg %>
      </div>
    <hr />
      
    <div class="page-header">
      <h3> Propriétés </h3>
    </div>
      
	<% if @quotation.attach.exists? %> 
		<div class="field"><div class="span2">Fichier-joint actuel : </div><%= link_to image_tag('glyphicons/glyphicons_062_attach.png') + ' ' + @quotation.attach_file_name, @quotation.attach.url, :target => '_blank' %></div>
		<div class="field"><div class="span2">Modifier le fichier-joint : </div><%= f.file_field :attach, :style=>'width: 20em;' %></div>
		<% else %>
		<div class="field"><div class="span2">Fichier-joint : </div><%= f.file_field :attach, :style=>'width: 20em;'%></div>
	<% end %>
	
      
	  <div class="field"> 
        <div class="span2">Statut : </div><%= f.select :statut, Quotation::STATUTS %>
      </div>
      <div class="field" id="nameOpportunity">
        <%= render :partial => 'opportunities' %>
      </div>
      <div class="field"> 
        <div class="span2">Modèle : </div><%= f.collection_select :quotation_template_id, QuotationTemplate.order('company ASC').all, :id, :company, { :class => 'required' } %>
      </div>

	    <br />
  	
	<div class="field">
    <% if !@quotation.id.nil? %>
		<div class="span9"> Créé par : <%= @quotation.author.full_name %>, le </strong><%= @quotation.created_at.strftime("%d/%m/%y à %H:%M") %>. </div> <br />
		
		<% if !@quotation.updated_by.nil? %>
			<div class="span9"> Dernièrement modifié par : <%= @quotation.editor.full_name %>, le <%= @quotation.updated_at.strftime("%d/%m/%y à %H:%M") %>. </div> <br />
		
		<% else %>
		<% end %>
		
	<% end %>
	</div>
	  
	<hr />
 
     <div class="row">
	<%=
          if !@quotation.id.nil?
            f.submit('Modifier ce Devis', :class =>"btn btn-primary", :id =>"quotation_submit_form" )
          else
            f.submit('Créer un Devis', :class =>"btn btn-primary", :id =>"quotation_submit_form" )
          end
        %>
      <%= if !@quotation.id.nil? then link_to image_tag("glyphicons/glyphicons_016_bin.png"), @quotation, :title => "Supprimer ce Devis", :class =>"pull-right btn", :confirm => 'Confirmer la suppression ?', :method => :delete end %> 
    </div>
  </div>

  <% end %>
</div>
