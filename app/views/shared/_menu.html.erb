<div class="navbar">
  <div id="navbar-inner" class="navbar-inner">
	<div id="left-bar-container">	
	  <%= link_to image_tag("logo_crm_small.png"), url_for(:controller => 'home', :action => 'index' ) ,:class =>"brand" , :title => "Tableau de bord" %>
	  <div id="nav-menu">
			<ul class="nav" style="font-size: 14px;">
				<!-- TASKS -->
				<% cssClass = (params[:controller] == 'tasks') ? 'active' : '' %>
				<li class="<%= "#{cssClass} "%>">
					<%= link_to (image_tag("icons/tache_blanc.png", :size => "16x16")+" Tâches").html_safe, url_for(:controller => 'tasks', :action => 'filter') %>
				</li>
				<!-- ACTORS -->
				<% cssClass = (params[:controller] == 'accounts' or params[:controller] == 'events' or params[:controller] == 'contacts') ? cssClass = 'active' : '' %>
				<li class="dropdown<%= if !cssClass.blank? then " #{cssClass}" end %>">
				<a class="dropdown-toggle" data-toggle="dropdown" href="#">
					<%= image_tag("icons/3people_blanc2.png", :size => "20x16", :style => 'height: 16px; margin-top: 1px;') %> Acteurs
					<span class="caret"></span>
				</a>
				<ul class="dropdown-menu">
					<li><%= link_to "Comptes".html_safe, accounts_path %></li>
					<li><%= link_to "Contacts".html_safe, contacts_path %></li>
				</ul>
				</li>
				<!-- TRADES -->
				<% cssClass = (params[:controller] == 'quotations' or params[:controller] == 'opportunities') ? 'active' : '' %>
				<li class="dropdown<%= if !cssClass.blank? then " #{cssClass}" end %>">
					<a class="dropdown-toggle" data-toggle="dropdown" href="#">
						<%= image_tag("icons/glyphicons_040_stats_white.png", :size => "20x16") %> Commerce
						<span class="caret"></span>
					</a>
					<ul class="dropdown-menu">
						<li><%= link_to "Opportunités".html_safe, opportunities_path %></li>
						<li><%= link_to "Devis".html_safe, quotations_path %></li>
					</ul>
				</li>
			</ul>
	  </div>
	</div>
	<div id="right-bar-container">
		<!-- FORM SEARCH -->
	    <div id="form-search-container">
			<%= form_tag(search_accounts_path, :method => "get", :class =>"form-search", :id =>"form-search") do %>
			<div class="input-append">
				<%= text_field_tag :account , nil , { 
				  :class =>"span3", 
				  :placeholder => " Rechercher un acteur...", 
				  :autocomplete=> "off", 
				  :type => 'text',
				  :id => 'main-search-bar' } %>
				<button type="submit" class="btn">
				<span class="icon-search"></span>
				</button>
			</div>
			<ul id="search-list" class="typeahead dropdown-menu"></ul>
		<% end %>
		</div>
		
		<% if user_signed_in? %>
		<div id="profile_settings_buttons">
		
			<div class="btn-group">
				<a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
				 <%= image_tag('/assets/glyphicons/glyphicons_190_circle_plus.png', :size => '16x16') %>
				</a>
				<ul class="dropdown-menu right">
					<li><%= link_to t('app.model.Quotation'), new_quotation_path %></li>
					<li><%= link_to t('app.model.Opportunity'), new_opportunity_path %></li>
					<li><%= link_to t('app.model.Task'), new_task_path %></li>
					<li><%= link_to t('app.model.Contact'), new_contact_path %></li>
					<li><%= link_to t('app.model.Account'), new_account_path %></li>
					<li><%= link_to t('app.model.Document'), new_document_path %></li>
				</li>
				</ul>
			</div>
			<div class="btn-group">
			<a id="link-button-profile" class="btn dropdown-toggle" data-toggle="dropdown" href="#">
				<i class="icon-user"></i>
				<% if current_user.forename.length < 10 %>
          <%= content_tag('span', current_user.forename, :id => 'current_user', 'data-id' => current_user.id) %>
        <% else %>
          <%= content_tag('span', current_user.forename[0..10] + '...') %>
				<% end %>
			  <span class="caret"></span>
			</a>
			<ul class="dropdown-menu right">
				<li><%= link_to 'Profil', edit_user_path(current_user) %></li>
				<li class="divider"></li>
				<li><%= link_to 'Déconnexion', destroy_user_session_path, :data => {:confirm => 'Confirmer la déconnexion ?'}, :method => :delete %></li>
			</ul>
			</div>
			<div class="btn-group">
			<a class="btn dropdown-toggle " data-toggle="dropdown" href="#">
				<%= image_tag("glyphicons/glyphicons_280_settings.png", :size => "16x16") %>
			</a>
			<ul class="dropdown-menu right">
				<li class="dropdown-submenu pull-left">
				<a tabindex="-1" href="#">Configuration</a>
				<ul class="dropdown-menu ">
					<li><%= link_to 'Utilisateurs', users_path %></li>
					<li><%= link_to 'Types', event_types_path %></li>
					<li><%= link_to 'Tags', tags_path %></li>
					<li><%= link_to 'Origines', origins_path %></li>
					<li><%= link_to 'Modèles devis', quotation_templates_path %></li>
					<% if current_user.has_role?(:admin) %>
					<li><%= link_to 'Configuration', settings_path %></li>
					<% end %>
				</ul>
				</li>
				<li class="dropdown-submenu pull-left">
				<a tabindex="-1" href="#">Extraction</a>
				<ul class="dropdown-menu ">
					<li><%= link_to 'Comptes', url_for(:controller => 'extractions', :action => 'select_param_accounts') %></li>
					<li><%= link_to 'Contacts', url_for(:controller => 'extractions', :action => 'select_param_contacts') %></li>
				</ul>
				</li>
				<li class="divider"></li>
				<li><%= link_to 'À propos', '/about' %></li>
			</ul>
			</div>
		</div>
		<% end %>
	</div>

  </div>
</div>
<script type="application/x-javascript">
  var dom_browse_offset = function(dom_object) {
	  return dom_object.offsetParent ? dom_object.offsetLeft + dom_browse_offset(dom_object.offsetParent) : dom_object.offsetLeft;
	};

  var dom_profile = document.getElementById('profile_settings_buttons');
	var dom_search_form = document.getElementById('form-search-container');
	var left = dom_browse_offset(dom_profile);
	var right = window.innerWidth - left - 15;
	$(dom_search_form).attr('style', 'right: ' + right + 'px;');

</script>

