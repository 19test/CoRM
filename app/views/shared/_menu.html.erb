<div class="navbar">
  <div id="navbar-inner" class="navbar-inner">
    <div id="left-bar-container">	
      <%= link_to image_tag("logo_crm_small.png"), url_for(:controller => 'home', :action => 'index' ) ,:class =>"brand" , :title => "Tableau de bord" %>
      <div id="nav-menu">
        <ul class="nav" style="font-size: 14px;">

          <!-- TASKS -->

          <% cssClass = (params[:controller] == 'tasks') ? 'active' : '' %>
          <li class="<%= "#{cssClass} "%>">
            <%= link_to (image_tag("icons/tache_blanc.png", :size => "16x16")+" Tâches").html_safe, url_for(:controller => 'tasks') %>
          </li>

          <!-- ACTORS -->

          <% cssClass = (params[:controller] == 'accounts' or params[:controller] == 'events' or params[:controller] == 'contacts') ? cssClass = 'active' : '' %>
          <li class="dropdown<%= if !cssClass.blank? then " #{cssClass}" end %>">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
              <%= image_tag("icons/3people_blanc2.png", :size => "20x16", :style => 'height: 16px; margin-top: 1px;') %> Acteurs
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              <li><%= link_to "Comptes".html_safe, accounts_path %></li>
              <li><%= link_to "Contacts".html_safe, contacts_path %></li>
            </ul>
          </li>

          <!-- TRADES -->

          <% cssClass = (params[:controller] == 'quotations' or params[:controller] == 'opportunities') ? 'active' : '' %>
          <li class="dropdown<%= if !cssClass.blank? then " #{cssClass}" end %>">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
              <%= image_tag("icons/glyphicons_040_stats_white.png", :size => "20x16") %> Commerce
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              <li><%= link_to "Opportunités".html_safe, opportunities_path %></li>
              <li><%= link_to "Devis".html_safe, quotations_path %></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
    <div id="right-bar-container">

      <!-- FORM SEARCH -->

      <div id="form-search-container">
        <%= form_tag(search_accounts_path, :method => "get", :class =>"form-search", :id =>"form-search") do %>
          <div class="input-append">
            <%= text_field_tag :account , nil , { 
              :class =>"span3", 
              :placeholder => " Rechercher un acteur...", 
              :autocomplete=> "off", 
              :type => 'text',
              :id => 'main-search-bar' } %>
              <button type="submit" class="btn">
                <i class="fa fa-search fa-fw"></i>
              </button>
            </div>
            <ul id="search-list" class="typeahead dropdown-menu"></ul>
          <% end %>
        </div>

        <% if user_signed_in? %>
          <div id="profile_settings_buttons">
            <ul class="nav">	
              <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#" title ="Créer...">
                  <%= icon('plus') %>
                </a>
                <ul class="dropdown-menu right">
                  <li><%= link_to t('app.model.Quotation'), new_quotation_path %></li>
                  <li><%= link_to t('app.model.Opportunity'), new_opportunity_path %></li>
                  <li><%= link_to t('app.model.Task'), new_task_path %></li>
                  <li><%= link_to t('app.model.Contact'), new_contact_path %></li>
                  <li><%= link_to t('app.model.Account'), new_account_path %></li>
                  <li><%= link_to t('app.model.Document'), new_document_path %></li>
                </ul>
              </li>

              <!-- NOTIFICATIONS -->
              <li>	
                <a class=" " title ="Notifications"
                  <%= link_to icon('bell').html_safe, url_for(:controller => 'notifications', :action => 'index')%>
                </a>
                <% if current_user.emails.length > 0 %>
                  <%= link_to current_user.emails.length, url_for(:controller => 'notifications', :action => 'index'),  {:class => "badge btn-danger btn-sm", :style => "z-index:2; position: absolute; top: 0px; left: 68px;"} %>
                <% end %>
              </li>

              <!-- PROFIL -->

              <li class="dropdown"> 
                <a class="dropdown-toggle" data-toggle="dropdown" href="#" title ="Profil et paramètres">
                  <%= icon('cogs') %>
                </a>
                <ul class="dropdown-menu right">
                  <center><li role="presentation" class="dropdown-header" style="font-weight: bold"><%= current_user.forename %></li></center>
                  <li class="divider"></li>
                  <li><%= link_to '<i class="fa fa-user fa-fw"></i> Profil'.html_safe, edit_user_path(current_user) %></li>        
                  <li><%= link_to '<i class="fa fa-power-off fa-fw"></i> Déconnexion'.html_safe, destroy_user_session_path, :data => {:confirm => 'Confirmer la déconnexion ?'}, :method => :delete %></li>
                  <!-- SETTINGS in PROFIL -->

                  <% if current_user.has_role?(:admin) or current_user.has_role?(:super_user) %>
                    <li class="divider"></li>

                    <center><li role="presentation" class="dropdown-header" style="font-weight: bold">Administration</li></center>
                    <li class="divider"></li>

                    <li class="dropdown-submenu pull-left">
                      <a tabindex="-1" href="#"><i class="fa fa-cog fa-fw"></i> Configuration</a>
                      <ul class="dropdown-menu ">
                        <li><%= link_to '<i class="fa fa-users fa-fw"></i> Utilisateurs'.html_safe, users_path %></li>
                        <li><%= link_to '<i class="fa fa-calendar-o fa-fw"></i> Types'.html_safe, event_types_path %></li>
                        <li><%= link_to '<i class="fa fa-tags fa-fw"></i> Tags'.html_safe, tags_path %></li>
                        <li><%= link_to '<i class="fa fa-fast-backward fa-fw"></i> Origines'.html_safe, origins_path %></li>
                        <li><%= link_to '<i class="fa fa-files-o fa-fw"></i> Modèles devis'.html_safe, quotation_templates_path %></li>
                        <% if current_user.has_role?(:admin) %>
                          <li class="divider"></li>
                          <li><%= link_to 'Configuration CoRM', url_for({ :controller => 'settings', :action => 'index' }) %></li>
                        <% end %>
                      </ul>
                    </li>
                    <li class="dropdown-submenu pull-left">
                      <a tabindex="-1" href="#"><i class="fa fa-cloud-download fa-fw"></i> Extraction</a>
                      <ul class="dropdown-menu ">
                        <li><%= link_to '<i class="fa fa-briefcase fa-fw"></i> Comptes'.html_safe, url_for(:controller => 'extractions', :action => 'select_param_accounts') %></li>
                        <li><%= link_to '<i class="fa fa-users fa-fw"></i> Contacts'.html_safe, url_for(:controller => 'extractions', :action => 'select_param_contacts') %></li>
                      </ul>
                    </li>

                  <% end %>
                  <li class="divider"></li>
                  <li><%= link_to '<i class="fa fa-info-circle fa-fw"></i> À propos'.html_safe, '/about' %></li>

                </ul>
              </li>
            </ul>
          </div>
        <% end %>
      </div>

    </div>
  </div>
  <script type="application/x-javascript">
    var dom_browse_offset = function(dom_object) {
      return dom_object.offsetParent ? dom_object.offsetLeft + dom_browse_offset(dom_object.offsetParent) : dom_object.offsetLeft;
    };

var dom_profile = document.getElementById('profile_settings_buttons');
var dom_search_form = document.getElementById('form-search-container');
var left = dom_browse_offset(dom_profile);
var right = window.innerWidth - left - 15;
$(dom_search_form).attr('style', 'right: ' + right + 'px;');

</script>

